(function(d,s){if(!document.querySelectorAll){d=document,s=d.createStyleSheet();d.querySelectorAll=function(r,c,i,j,a){a=d.all,c=[],r=r.replace(/\[for\b/gi,"[htmlFor").split(",");for(i=r.length;i--;){s.addRule(r[i],"k:v");for(j=a.length;j--;){a[j].currentStyle.k&&c.push(a[j]);}s.removeRule(0);}return c;};}})();(function(window,document,undefined){var Autocomplete=function(options){this.options={element:"input[list]",data:[],maxChoices:7,highlight:true,caseSensitive:false,wrapClassName:"acwrap"};this.selectedIndex=-1;this.arrowflag=true;this.lastKeyword;if(options){for(var option in this.options){if(Object.prototype.hasOwnProperty.call(this.options,option)&&options[option]!==undefined){this.options[option]=options[option];}}}this.init();};Autocomplete.prototype.init=function(){var current=this,dataArr=current.options.data,inputs=document.querySelectorAll(this.options.element);each(inputs,function(input,i){var wrapper=document.createElement("span");wrapper.className=current.options.wrapClassName;wrap(wrapper,input);var results=document.createElement("ul");results.className="results hidden";results.style.width=input.width;wrapper.appendChild(results);current.register.call(current,input,results);});};Autocomplete.prototype.arrowpress=function(keycode,li,input){var current=this,lilength=li.length,selectVal;for(var i=0;i<lilength;i++){removeClass(li[i],"selected");}if(lilength>current.selectedIndex&&lilength>0){if(keycode==40){current.selectedIndex++;if(lilength==current.selectedIndex){current.selectedIndex=0;}}else{if(keycode==38){current.selectedIndex--;if(current.selectedIndex==-1){current.selectedIndex=lilength-1;}}}if(keycode==40||keycode==38){selectVal=li[current.selectedIndex].getAttribute("rel");addClass(li[current.selectedIndex],"selected");input.value=selectVal;current.arrowflag=false;current.lastKeyword=selectVal;}}if(current.lastKeyword!=selectVal){current.selectedIndex=-1;current.arrowflag=true;}};Autocomplete.prototype.register=function(input,results){var current=this;addEvent(input,"keyup",function(event){var event=event||window.event,keycode=event.charCode||event.keyCode,text=input.value,foundArr=current.getHavingDataArray(current.options.data,text),foundLength=foundArr.length;if(keycode>8&&keycode<32){return;}current.arrowpress(keycode,results.getElementsByTagName("li"),input);if(!current.arrowflag){return;}if(text.trim().length==0||foundLength==0){addClass(results,"hidden");return;}var frag=document.createDocumentFragment();for(var i=0,length=foundArr.length;i<length;i++){var li=document.createElement("li"),textNode=document.createTextNode(foundArr[i]);li.setAttribute("rel",foundArr[i]);li.appendChild(textNode);frag.appendChild(li);current.highlight(text,li,foundArr);if(i+1==current.options.maxChoices){break;}}results.innerHTML="";results.appendChild(frag);removeClass(results,"hidden");});addEvent(input,"blur",function(event){this.flag=true;addClass(results,"hidden");});addEvent(results,"mousedown",function(event){var target=getEventTarget(event);input.value=target.getAttribute("rel");});};Autocomplete.prototype.highlight=function(text,li,foundArr){if(this.options.highlight===false){return false;}if(this.options.caseSensitive){var re=new RegExp(text);for(var i=0,length=foundArr.length;i<length;i++){var newVal=foundArr[i].replace(re,"<span class='found'>"+text+"</span>");li.innerHTML=li.innerHTML.replace(foundArr[i],newVal);}}else{var re=new RegExp(text,"i");for(var i=0,length=foundArr.length;i<length;i++){var matched=foundArr[i].match(re);var newVal=foundArr[i].replace(re,"<span class='found'>"+matched[0]+"</span>");li.innerHTML=li.innerHTML.replace(foundArr[i],newVal);}}};Autocomplete.prototype.getHavingDataArray=function(array,inputStr){var newarr=[],i=array.length;while(i--){var sourceStr=array[i];if(this.options.caseSensitive===false){sourceStr=array[i].toLowerCase();inputStr=inputStr.toLowerCase();}if(sourceStr.indexOf(inputStr)!=-1){newarr.push(array[i]);}}return newarr.sort();};if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}function hasClass(elem,className){return((" "+elem.className+" ").replace(/[\n\t\r]/g," ").indexOf(" "+className+" ")>-1);}function addClass(elem,className){if(!hasClass(elem,className)){elem.className+=" "+className;}}function removeClass(elem,className){var newClass=" "+elem.className.replace(/[\t\r\n]/g," ")+" ";if(hasClass(elem,className)){while(newClass.indexOf(" "+className+" ")>=0){newClass=newClass.replace(" "+className+" "," ");}elem.className=newClass.trim();}}function wrap(wrapper,wrappee){var parent=wrappee.parentNode,sibling=wrappee.nextSibling;wrapper.appendChild(wrappee);if(sibling){parent.insertBefore(wrapper,sibling);}else{parent.appendChild(wrapper);}}function getEventTarget(e){e=e||window.event;return e.target||e.srcElement;}function each(obj,fn){if(obj.length){for(var i=0,ol=obj.length,v=obj[0];i<ol&&fn(v,i)!==false;v=obj[++i]){}}else{for(var p in obj){if(fn(obj[p],p)===false){break;}}}}function addEvent(elem,type,listener){return document.addEventListener?elem.addEventListener(type,listener,false):elem.attachEvent("on"+type,listener);}window.Autocomplete=Autocomplete;})(this,this.document);